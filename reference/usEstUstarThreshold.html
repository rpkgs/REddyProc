<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>usEstUstarThreshold - Estimating ustar threshold — usEstUstarThreshold • REddyProc</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="usEstUstarThreshold - Estimating ustar threshold — usEstUstarThreshold"><meta property="og:description" content="Estimate the Ustar threshold by aggregating the estimates for
seasonal and temperature subsets."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">REddyProc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/aggUncertainty.html">Uncertainty aggregation</a>
    </li>
    <li>
      <a href="../articles/bigleaf.html">Using bigleaf functions</a>
    </li>
    <li>
      <a href="../articles/DEGebExample.html">DEGeb example: UStar estimation</a>
    </li>
    <li>
      <a href="../articles/gapFilling.html">gap Filling</a>
    </li>
    <li>
      <a href="../articles/useCase.html">REddyProc typical workflow</a>
    </li>
    <li>
      <a href="../articles/uStarCases.html">uStar threshold cases</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/bgctw/REddyProc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>usEstUstarThreshold - Estimating ustar threshold</h1>

    <div class="hidden name"><code>usEstUstarThreshold.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimate the Ustar threshold by aggregating the estimates for
seasonal and temperature subsets.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">usEstUstarThreshold</span><span class="op">(</span><span class="va">ds</span>, seasonFactor <span class="op">=</span> <span class="fu"><a href="usCreateSeasonFactorMonth.html">usCreateSeasonFactorMonth</a></span><span class="op">(</span><span class="va">ds</span><span class="op">$</span><span class="va">sDateTime</span><span class="op">)</span>, </span>
<span>    yearOfSeasonFactor <span class="op">=</span> <span class="fu"><a href="usGetYearOfSeason.html">usGetYearOfSeason</a></span><span class="op">(</span><span class="va">seasonFactor</span>, </span>
<span>        <span class="va">ds</span><span class="op">$</span><span class="va">sDateTime</span><span class="op">)</span>, ctrlUstarEst <span class="op">=</span> <span class="fu"><a href="usControlUstarEst.html">usControlUstarEst</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    ctrlUstarSub <span class="op">=</span> <span class="fu"><a href="usControlUstarSubsetting.html">usControlUstarSubsetting</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    fEstimateUStarBinned <span class="op">=</span> <span class="va">usEstUstarThresholdSingleFw2Binned</span>, </span>
<span>    isCleaned <span class="op">=</span> <span class="cn">FALSE</span>, isInBootstrap <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-ds">ds<a class="anchor" aria-label="anchor" href="#arg-ds"></a></dt>
<dd><p>data.frame with columns "sDateTime", "Ustar", "NEE", "Tair", and "Rg"</p></dd>

  <dt id="arg-seasonfactor">seasonFactor<a class="anchor" aria-label="anchor" href="#arg-seasonfactor"></a></dt>
<dd><p>factor for subsetting times (see details)</p></dd>

  <dt id="arg-yearofseasonfactor">yearOfSeasonFactor<a class="anchor" aria-label="anchor" href="#arg-yearofseasonfactor"></a></dt>
<dd><p>named integer vector: for each seasonFactor level, get the year
(aggregation period) that this season belongs to</p></dd>

  <dt id="arg-ctrlustarest">ctrlUstarEst<a class="anchor" aria-label="anchor" href="#arg-ctrlustarest"></a></dt>
<dd><p>control parameters for estimating uStar on a single binned series,
see <code><a href="usControlUstarEst.html">usControlUstarEst</a></code></p></dd>

  <dt id="arg-ctrlustarsub">ctrlUstarSub<a class="anchor" aria-label="anchor" href="#arg-ctrlustarsub"></a></dt>
<dd><p>control parameters for
subsetting time series (number of temperature and Ustar classes ...),
see <code><a href="usControlUstarSubsetting.html">usControlUstarSubsetting</a></code></p></dd>

  <dt id="arg-festimateustarbinned">fEstimateUStarBinned<a class="anchor" aria-label="anchor" href="#arg-festimateustarbinned"></a></dt>
<dd><p>function to
estimate UStar on a single binned series,
see <code><a href="usEstUstarThresholdSingleFw2Binned.html">usEstUstarThresholdSingleFw2Binned</a></code></p></dd>

  <dt id="arg-iscleaned">isCleaned<a class="anchor" aria-label="anchor" href="#arg-iscleaned"></a></dt>
<dd><p>set to TRUE, if the data was cleaned already,
to avoid expensive call to <code>usGetValidUstarIndices</code>.</p></dd>

  <dt id="arg-isinbootstrap">isInBootstrap<a class="anchor" aria-label="anchor" href="#arg-isinbootstrap"></a></dt>
<dd><p>set to TRUE if this is called from
<code><a href="sEddyProc_sEstimateUstarScenarios.html">sEddyProc_sEstimateUstarScenarios</a></code> to avoid further
bootstraps in change-point detection</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The threshold for sufficiently turbulent conditions u * (Ustar)
is estimated for different subsets of the time series.
From the estimates for each season (each value in <code>seasonFactor</code>)
the maximum of all seasons of one year is reported as estimate for this year.
Within each season the time series is split by temperature classes.
Among these Ustar estimates, the median is reported as season value.</p>
<p>In order to split the seasons, the uses must provide a vector with argument
<code>seasonFactor</code>.
All positions with the same factor, belong to
the same season. It is conveniently generated by one of the following functions:</p><ul><li><p><code><a href="usCreateSeasonFactorMonth.html">usCreateSeasonFactorMonth</a></code>
(default DJF-MAM-JJA-SON with December from previous to January of the year)</p></li>
<li><p><code><a href="usCreateSeasonFactorMonthWithinYear.html">usCreateSeasonFactorMonthWithinYear</a></code>
(default DJF-MAM-JJA-SON with December from the same year)</p></li>
<li><p><code><a href="usCreateSeasonFactorYday.html">usCreateSeasonFactorYday</a></code>
for a refined specification of season starts.</p></li>
<li><p><code><a href="usCreateSeasonFactorYdayYear.html">usCreateSeasonFactorYdayYear</a></code>
for specifying different seasons season between years.</p></li>
</ul><p>The estimation of Ustar on a single binned series can be selected argument
<code>fEstimateUStarBinned</code>.</p><ul><li><p><code><a href="usEstUstarThresholdSingleFw1Binned.html">usEstUstarThresholdSingleFw1Binned</a></code></p></li>
<li><p><code><a href="usEstUstarThresholdSingleFw2Binned.html">usEstUstarThresholdSingleFw2Binned</a></code> (default)</p></li>
</ul><p>This function is called by</p><ul><li><p><code><a href="sEddyProc_sEstUstarThold.html">sEddyProc_sEstUstarThold</a></code> which stores the result
in the class variables (sUSTAR and sDATA).</p></li>
<li><p><code><a href="sEddyProc_sEstUstarThresholdDistribution.html">sEddyProc_sEstUstarThresholdDistribution</a></code> which
additionally estimates median and confidence intervals for each year
by bootstrapping the original data within seasons.</p></li>
</ul><p>For inspecting the NEE~uStar relationship plotting is provided by
<code><a href="sEddyProc_sPlotNEEVersusUStarForSeason.html">sEddyProc_sPlotNEEVersusUStarForSeason</a></code></p>
<dl></dl><dl></dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list with entries
data.frame with columns "aggregationMode", "seasonYear", "season", "uStar"
with rows for "single": the entire aggregate (median across years)
, "seasonYear": each year (maximum across seasons or estimate on pooled data)
, "season": each season (median across temperature classes)</p>
<dl><dt>seasonYear</dt>
<dd><p>data.frame
listing results for year with columns "seasonYear"
, "uStarMaxSeason" the maximum across seasonal estimates within the year
, "uStarPooled" the estimate based on data pooled across the year
(only calculated on few valid records or on uStarMaxSeason was nonfinite)
, "nRec" number of valid records  (only if the pooled estimate was calculated)
, "uStarAggr" chosen estimate, corresponding to uStarPooled
if this was calculated,
or uStarMaxSeason or uStarTh across years if the former was non-finite</p></dd>

<dt>season</dt>
<dd><p>data.frame listing results for each season
, "nRec" the number of valid records
, "uStarSeasonEst" the estimate for based on data within the season
(median across temperature classes)
, "uStarAggr" chose estimate, corresponding to uStarSeasonEst,
or the yearly seasonYear$uStarAggr, if the former was non-finite</p></dd>

<dt>tempInSeason</dt>
<dd><p>numeric matrix
(nTemp x nAggSeason):
estimates for each temperature subset for each season</p></dd>

<dt>bins</dt>
<dd><p>columns
<code>season</code>, <code>tempBin</code> and <code>uStarBin</code>
for each record of input <code>ds</code>
reporting classes of similar environmental conditions
that the record belongs to.</p></dd>
</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>Ustar filtering following the idea in Papale, D. et al. (2006)
Towards a standardized processing of net ecosystem exchange measured with
eddy covariance technique: algorithms and uncertainty estimation.
Biogeosciences 3(4): 571-583.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>TW, OM
Department for Biogeochemical Integration at MPI-BGC, Jena, Germany &lt;REddyProc-help@bgc-jena.mpg.de&gt; [cph], Thomas Wutzler &lt;twutz@bgc-jena.mpg.de&gt; [aut, cre], Markus Reichstein &lt;mreichstein@bgc-jena.mpg.de&gt; [aut], Antje Maria Moffat &lt;antje.moffat@bgc.mpg.de&gt; [aut, trl], Olaf Menzer &lt;omenzer@bgc-jena.mpg.de&gt; [ctb], Mirco Migliavacca &lt;mmiglia@bgc-jena.mpg.de&gt; [aut], Kerstin Sickel &lt;ksickel@bgc-jena.mpg.de&gt; [ctb, trl], Ladislav &lt;U+0160&gt;igut &lt;sigut.l@czechglobe.cz&gt; [ctb]</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Thomas Wutzler, Markus Reichstein, Antje Maria Moffat, Mirco Migliavacca.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

