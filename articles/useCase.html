<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REddyProc typical workflow • REddyProc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="REddyProc typical workflow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">REddyProc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aggUncertainty.html">Uncertainty aggregation</a>
    </li>
    <li>
      <a href="../articles/bigleaf.html">Using bigleaf functions</a>
    </li>
    <li>
      <a href="../articles/DEGebExample.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/gapFilling.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/useCase.html">REddyProc typical workflow</a>
    </li>
    <li>
      <a href="../articles/uStarCases.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bgctw/REddyProc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>REddyProc typical workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bgctw/REddyProc/blob/master/vignettes/useCase.Rmd" class="external-link"><code>vignettes/useCase.Rmd</code></a></small>
      <div class="hidden name"><code>useCase.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="reddyproc-typical-workflow">REddyProc typical workflow<a class="anchor" aria-label="anchor" href="#reddyproc-typical-workflow"></a>
</h2>
<div class="section level3">
<h3 id="importing-the-half-hourly-data">Importing the half-hourly data<a class="anchor" aria-label="anchor" href="#importing-the-half-hourly-data"></a>
</h3>
<p>The workflow starts with importing the half-hourly data. The example,
reads a text file with data of the year 1998 from the Tharandt site and
converts the separate decimal columns year, day, and hour to a POSIX
timestamp column. Next, it initializes the <code>sEddyProc</code>
class.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#+++ load libraries used in this vignette</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.bgc-jena.mpg.de/bgi/index.php/Services/REddyProcWeb" class="external-link">REddyProc</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">##   object 'type_sum.accel' not found</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#+++ Load data with 1 header and 1 unit row from (tab-delimited) text file</span></span>
<span><span class="va">fileName</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getExamplePath.html">getExamplePath</a></span><span class="op">(</span><span class="st">'Example_DETha98.txt'</span>, isTryDownload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">EddyData</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fileName</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="../reference/fLoadTXTIntoDataframe.html">fLoadTXTIntoDataframe</a></span><span class="op">(</span><span class="va">fileName</span><span class="op">)</span> <span class="kw">else</span></span>
<span>  <span class="co"># or use example dataset in RData format provided with REddyProc</span></span>
<span>  <span class="va">Example_DETha98</span></span>
<span><span class="co">#+++ Replace long runs of equal NEE values by NA</span></span>
<span><span class="va">EddyData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterLongRuns.html">filterLongRuns</a></span><span class="op">(</span><span class="va">EddyData</span>, <span class="st">"NEE"</span><span class="op">)</span></span>
<span><span class="co">#+++ Add time stamp in POSIX time format</span></span>
<span><span class="va">EddyDataWithPosix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fConvertTimeToPosix.html">fConvertTimeToPosix</a></span><span class="op">(</span></span>
<span>  <span class="va">EddyData</span>, <span class="st">'YDH'</span>,Year <span class="op">=</span> <span class="st">'Year'</span>,Day <span class="op">=</span> <span class="st">'DoY'</span>, Hour <span class="op">=</span> <span class="st">'Hour'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/filterLongRuns.html">filterLongRuns</a></span><span class="op">(</span><span class="st">"NEE"</span><span class="op">)</span></span>
<span><span class="co">#+++ Initalize R5 reference class sEddyProc for post-processing of eddy data</span></span>
<span><span class="co">#+++ with the variables needed for post-processing later</span></span>
<span><span class="va">EProc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/sEddyProc.html">sEddyProc</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">'DE-Tha'</span>, <span class="va">EddyDataWithPosix</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NEE'</span>,<span class="st">'Rg'</span>,<span class="st">'Tair'</span>,<span class="st">'VPD'</span>, <span class="st">'Ustar'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>A fingerprint-plot of the source half-hourly shows already several
gaps. A fingerprint-plot is a color-coded image of the half-hourly
fluxes by daytime on the x and and day of the year on the y axis.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sPlotFingerprintY</span><span class="op">(</span><span class="st">'NEE'</span>, Year <span class="op">=</span> <span class="fl">1998</span><span class="op">)</span></span></code></pre></div>
<p><img src="useCase_files/figure-html/fpNEEOrig-1.png" width="700"></p>
<p>For writing plots of data of several years to pdf see also</p>
<ul>
<li>
<a href="../html/sEddyProc_sPlotFingerprint.html"><code>sEddyProc_sPlotFingerprint</code></a>,</li>
<li>
<a href="../html/sEddyProc_sPlotHHFluxes.html"><code>sEddyProc_sPlotHHFluxes</code></a>,
and</li>
<li>
<a href="../html/sEddyProc_sPlotDiurnalCycle.html"><code>sEddyProc_sPlotDiurnalCycle</code></a>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="estimating-the-ustar-threshold-distribution">Estimating the uStar threshold distribution<a class="anchor" aria-label="anchor" href="#estimating-the-ustar-threshold-distribution"></a>
</h3>
<p>The second step, is the estimation of the distribution of uStar
thresholds, to identify periods of low friction velocity (uStar), where
NEE is biased low. Discarding periods with low uStar is one of the
largest sources of uncertainty in aggregated fluxes. Hence, several
quantiles of the distribution of the uncertain uStar threshold are
estimated by a bootstrap.</p>
<p>The friction velocity, uStar, needs to be in column named “Ustar” of
the input dataset.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sEstimateUstarScenarios</span><span class="op">(</span></span>
<span>    nSample <span class="op">=</span> <span class="fl">100L</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sGetEstimatedUstarThresholdDistribution</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   aggregationMode seasonYear  season     uStar        5%       50%       95%</span></span>
<span><span class="co">## 1          single         NA    &lt;NA&gt; 0.4162500 0.3981380 0.4629823 0.6278467</span></span>
<span><span class="co">## 2            year       1998    &lt;NA&gt; 0.4162500 0.3981380 0.4629823 0.6278467</span></span>
<span><span class="co">## 3          season       1998 1998001 0.4162500 0.3981380 0.4629823 0.6278467</span></span>
<span><span class="co">## 4          season       1998 1998003 0.4162500 0.3403006 0.4161250 0.5672456</span></span>
<span><span class="co">## 5          season       1998 1998006 0.3520000 0.3137000 0.3890794 0.4713304</span></span>
<span><span class="co">## 6          season       1998 1998009 0.3369231 0.2395846 0.3816705 0.5275798</span></span>
<span><span class="co">## 7          season       1998 1998012 0.1740000 0.2329000 0.4248958 0.5931500</span></span></code></pre>
<p>The output reports annually aggregated uStar estimates of 0.42 for
the original data and 0.4, 0.46, 0.63 for lower, median, and upper
quantile of the estimated distribution. The threshold can vary between
periods of different surface roughness, e.g. before and after harvest.
Therefore, there are estimates for different time periods, called
seasons. These season-estimates are by default aggregated to entire
years.</p>
<p>The subsequent post processing steps will be repeated using the four
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>
threshold scenarios (non-resampled and tree quantiles of the
bootstrapped distribution). They require to specify a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>-threshold
for each season and a suffix to distinguish the outputs related to
different thresholds. By default the annually aggregated estimates are
used for each season within the year.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sGetUstarScenarios</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    season   uStar      U05       U50       U95</span></span>
<span><span class="co">## 1 1998001 0.41625 0.398138 0.4629823 0.6278467</span></span>
<span><span class="co">## 2 1998003 0.41625 0.398138 0.4629823 0.6278467</span></span>
<span><span class="co">## 3 1998006 0.41625 0.398138 0.4629823 0.6278467</span></span>
<span><span class="co">## 4 1998009 0.41625 0.398138 0.4629823 0.6278467</span></span>
<span><span class="co">## 5 1998012 0.41625 0.398138 0.4629823 0.6278467</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="gap-filling">Gap-filling<a class="anchor" aria-label="anchor" href="#gap-filling"></a>
</h3>
<p>The second post-processing step is filling the gaps in NEE using
information of the valid data. Here, we decide to use the same annual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>
threshold estimate in each season, as obtained above, and decide to
compute uncertainty also for valid records (FillAll).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sMDSGapFillUStarScens</span><span class="op">(</span><span class="st">'NEE'</span><span class="op">)</span></span></code></pre></div>
<p>The screen output (not shown here) already shows that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>-filtering
and gap-filling was repeated for each given estimate of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>
threshold , i.e. column in <code>uStarThAnnual</code>, with marking 22%
to 38% of the data as gap. For gap-filling without prior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>-filtering
using <code>sEddyProc_sMDSGapFill</code> or for applying single or
user-specified
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>
thresholds using <code>sEddyProc_sMDSGapFillAfterUstar</code> see
<code><a href="../articles/uStarCases.html">vignette("uStarCases")</a></code>.</p>
<p>For each of the different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>
threshold estimates a separate set of output columns of filled NEE and
its uncertainty is generated, distinguished by the suffixes given with
<code>uStarSuffixes</code>. <suffix>“_f” denotes the filled value and
“_fsd” the estimated standard deviation of its uncertainty.</suffix></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"NEE_.*_f$"</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">EProc</span><span class="op">$</span><span class="fu">sExportResults</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"NEE_.*_fsd$"</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">EProc</span><span class="op">$</span><span class="fu">sExportResults</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "NEE_uStar_f" "NEE_U05_f"   "NEE_U50_f"   "NEE_U95_f"  </span></span>
<span><span class="co">## [1] "NEE_uStar_fsd" "NEE_U05_fsd"   "NEE_U50_fsd"   "NEE_U95_fsd"</span></span></code></pre>
<p>A fingerprint-plot of one of the new variables shows that gaps have
been filled.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sPlotFingerprintY</span><span class="op">(</span><span class="st">'NEE_U50_f'</span>, Year <span class="op">=</span> <span class="fl">1998</span><span class="op">)</span></span></code></pre></div>
<p><img src="useCase_files/figure-html/fpNEEFilled-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="partitioning-net-flux-into-gpp-and-reco">Partitioning net flux into GPP and Reco<a class="anchor" aria-label="anchor" href="#partitioning-net-flux-into-gpp-and-reco"></a>
</h3>
<p>The third post-processing step is partitioning the net flux (NEE)
into its gross components GPP and Reco. The partitioning needs to
distinguish carefully between night-time and day-time. Therefore it
needs a specification of geographical coordinates and time zone to allow
computing sunrise and sunset. Further, the missing values in the used
meteorological data need to be filled.</p>
<p>For VPD, which is important for daytime flux partitioning, and
additional gap-filling of longer gaps based on minimum daily temperature
(assumed dewpoint) is available.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sSetLocationInfo</span><span class="op">(</span>LatDeg <span class="op">=</span> <span class="fl">51.0</span>, LongDeg <span class="op">=</span> <span class="fl">13.6</span>, TimeZoneHour <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  </span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sMDSGapFill</span><span class="op">(</span><span class="st">'Tair'</span>, FillAll <span class="op">=</span> <span class="cn">FALSE</span>,  minNWarnRunLength <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>     </span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sMDSGapFill</span><span class="op">(</span><span class="st">'VPD'</span>, FillAll <span class="op">=</span> <span class="cn">FALSE</span>,  minNWarnRunLength <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>     </span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sFillVPDFromDew</span><span class="op">(</span><span class="op">)</span> <span class="co"># fill longer gaps still present in VPD_f</span></span></code></pre></div>
<p>Now we are ready to invoke the partitioning, here by the night-time
approach, for each of the several filled NEE columns.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sMRFluxPartitionUStarScens</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The results are stored in columns <code>Reco</code> and
<code>GPP_f</code> modified by the respective
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>
threshold suffix.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"GPP.*_f$|Reco"</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">EProc</span><span class="op">$</span><span class="fu">sExportResults</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Reco_U05"    "GPP_U05_f"   "Reco_U50"    "GPP_U50_f"   "Reco_U95"   </span></span>
<span><span class="co">## [6] "GPP_U95_f"   "Reco_uStar"  "GPP_uStar_f"</span></span></code></pre>
<p>Visualizations of the results by a fingerprint plot gives a compact
overview.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sPlotFingerprintY</span><span class="op">(</span><span class="st">'GPP_U50_f'</span>, Year <span class="op">=</span> <span class="fl">1998</span><span class="op">)</span></span></code></pre></div>
<p><img src="useCase_files/figure-html/fingerPrintGPP-1.png" width="700"></p>
<p>For using daytime-based flux partitioning see <a href="../html/sEddyProc_sGLFluxPartition.html"><code>sEddyProc_sGLFluxPartition</code></a>
computing columns <code>GPP_DT</code> and <code>Recco_DT</code>.</p>
</div>
<div class="section level3">
<h3 id="estimating-the-uncertainty-of-aggregated-results">Estimating the uncertainty of aggregated results<a class="anchor" aria-label="anchor" href="#estimating-the-uncertainty-of-aggregated-results"></a>
</h3>
<p>The results of the different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>
threshold scenarios can be used for estimating the uncertainty due to
not knowing the threshold.</p>
<p>First, the mean of the GPP across all the year is computed for each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>-scenario
and converted from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mi>m</mi><mi>o</mi><mi>l</mi><mspace width="0.167em"></mspace><mi>C</mi><msub><mi>O</mi><mn>2</mn></msub><mspace width="0.167em"></mspace><msup><mi>m</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><msup><mi>s</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">{\mu mol\, CO_2\,
m^{-2} s^{-1}}</annotation></semantics></math> to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mi>C</mi><mspace width="0.167em"></mspace><msup><mi>m</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><mi>y</mi><msup><mi>r</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">{gC\,m^{-2} yr^{-1}}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FilledEddyData</span> <span class="op">&lt;-</span> <span class="va">EProc</span><span class="op">$</span><span class="fu">sExportResults</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">uStarSuffixes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">EProc</span><span class="op">$</span><span class="fu">sGetUstarScenarios</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#suffix &lt;- uStarSuffixes[2]</span></span>
<span><span class="va">GPPAggCO2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span> <span class="va">uStarSuffixes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">suffix</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">GPPHalfHour</span> <span class="op">&lt;-</span> <span class="va">FilledEddyData</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"GPP_"</span>,<span class="va">suffix</span>,<span class="st">"_f"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">GPPHalfHour</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">molarMass</span> <span class="op">&lt;-</span> <span class="fl">12.011</span></span>
<span><span class="va">GPPAgg</span> <span class="op">&lt;-</span> <span class="va">GPPAggCO2</span> <span class="op">*</span> <span class="fl">1e-6</span> <span class="op">*</span> <span class="va">molarMass</span> <span class="op">*</span> <span class="fl">3600</span><span class="op">*</span><span class="fl">24</span><span class="op">*</span><span class="fl">365.25</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">GPPAgg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    uStar      U05      U50      U95 </span></span>
<span><span class="co">## 1919.176 1903.335 1946.106 1923.839</span></span></code></pre>
<p>The difference between those aggregated values is a first estimate of
uncertainty range in GPP due to uncertainty of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>
threshold.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">GPPAgg</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">GPPAgg</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">GPPAgg</span><span class="op">)</span> </span></code></pre></div>
<p>In this run of the example a relative error of about 2.2% is
inferred.</p>
<p>For a better but more time consuming uncertainty estimate, specify a
larger sample of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mo>*</mo></msub><annotation encoding="application/x-tex">u_*</annotation></semantics></math>
threshold values, for each repeat the post-processing, and compute
statistics from the larger sample of resulting GPP columns. This can be
achieved by specifying a larger sequence of quantiles when calling
<code>sEstimateUstarScenarios</code> in place of the command shown
above.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sEstimateUstarScenarios</span><span class="op">(</span> </span>
<span>  nSample <span class="op">=</span> <span class="fl">200</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.975</span>,length.out <span class="op">=</span> <span class="fl">39</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="storing-the-results-in-a-csv-file">Storing the results in a csv-file<a class="anchor" aria-label="anchor" href="#storing-the-results-in-a-csv-file"></a>
</h3>
<p>The results still reside inside the <code>sEddyProc</code> class. We
first export them to an R Data.frame, append the columns to the original
input data, and write this data.frame to text file in a temporary
directory.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FilledEddyData</span> <span class="op">&lt;-</span> <span class="va">EProc</span><span class="op">$</span><span class="fu">sExportResults</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">CombinedData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">EddyData</span>, <span class="va">FilledEddyData</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/fWriteDataframeToFile.html">fWriteDataframeToFile</a></span><span class="op">(</span><span class="va">CombinedData</span>, <span class="st">'DE-Tha-Results.txt'</span>, Dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># or without relying on data.frame EddyData</span></span>
<span><span class="co"># with replacing column DateTime by Year, DoY, and Hour:</span></span>
<span><span class="fu"><a href="../reference/fWriteDataframeToFile.html">fWriteDataframeToFile</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">EProc</span><span class="op">$</span><span class="fu">sExportData</span><span class="op">(</span><span class="op">)</span>, <span class="va">EProc</span><span class="op">$</span><span class="fu">sExportResults</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="st">'DE-Tha-Results_ydh.txt'</span>, </span>
<span>  isSplitDatetime<span class="op">=</span><span class="cn">TRUE</span>, Dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># tmp &lt;- fLoadTXTIntoDataframe(file.path(tempdir(),'DE-Tha-Results_ydh.txt'))</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Thomas Wutzler, Markus Reichstein, Antje Maria Moffat, Mirco Migliavacca.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
