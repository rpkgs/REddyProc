<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • REddyProc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">REddyProc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aggUncertainty.html">Uncertainty aggregation</a>
    </li>
    <li>
      <a href="../articles/bigleaf.html">Using bigleaf functions</a>
    </li>
    <li>
      <a href="../articles/DEGebExample.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/gapFilling.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/useCase.html">REddyProc typical workflow</a>
    </li>
    <li>
      <a href="../articles/uStarCases.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bgctw/REddyProc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
                        <h4 data-toc-skip class="author">Thomas
Wutzler</h4>
            
            <h4 data-toc-skip class="date">2024-12-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bgctw/REddyProc/blob/master/vignettes/DEGebExample.Rmd" class="external-link"><code>vignettes/DEGebExample.Rmd</code></a></small>
      <div class="hidden name"><code>DEGebExample.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="crop-example-demonstrating-multiple-years-and-user-defined-ustar-seasons">Crop example demonstrating multiple years and user defined
uStar-Seasons<a class="anchor" aria-label="anchor" href="#crop-example-demonstrating-multiple-years-and-user-defined-ustar-seasons"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#isDevelopMode &lt;- TRUE</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"isDevelopMode"</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.bgc-jena.mpg.de/bgi/index.php/Services/REddyProcWeb" class="external-link">REddyProc</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0815</span><span class="op">)</span>      <span class="co"># for reproducible results</span></span></code></pre></div>
<p>First, the data is loaded. This example uses data that has been
downloaded from <a href="http://www.europe-fluxdata.eu" class="external-link uri">http://www.europe-fluxdata.eu</a> and preprocessed by
<code>fLoadEuroFlux16</code>, where the DateTime Column has been
created, and the variables renamed to the BGC-convention (e.g. Tair
instead of Ta).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DEGebExample</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">DEGebExample</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     DateTime                        NEE              Ustar       </span></span>
<span><span class="co">##  Min.   :2004-01-01 00:30:00   Min.   :-49.919   Min.   :0.0000  </span></span>
<span><span class="co">##  1st Qu.:2004-10-01 00:22:30   1st Qu.: -1.864   1st Qu.:0.0640  </span></span>
<span><span class="co">##  Median :2005-07-02 00:15:00   Median :  0.635   Median :0.1490  </span></span>
<span><span class="co">##  Mean   :2005-07-02 00:15:00   Mean   : -1.935   Mean   :0.1884  </span></span>
<span><span class="co">##  3rd Qu.:2006-04-02 00:07:30   3rd Qu.:  1.834   3rd Qu.:0.2800  </span></span>
<span><span class="co">##  Max.   :2007-01-01 00:00:00   Max.   : 19.008   Max.   :2.0450  </span></span>
<span><span class="co">##                                NA's   :21849     NA's   :1149    </span></span>
<span><span class="co">##       Tair               rH               Rg         </span></span>
<span><span class="co">##  Min.   :-16.710   Min.   : 15.87   Min.   :   0.00  </span></span>
<span><span class="co">##  1st Qu.:  3.360   1st Qu.: 66.61   1st Qu.:   0.00  </span></span>
<span><span class="co">##  Median :  9.970   Median : 79.10   Median :   2.04  </span></span>
<span><span class="co">##  Mean   :  9.664   Mean   : 75.24   Mean   : 124.71  </span></span>
<span><span class="co">##  3rd Qu.: 15.520   3rd Qu.: 87.07   3rd Qu.: 176.03  </span></span>
<span><span class="co">##  Max.   : 34.680   Max.   :100.00   Max.   :1046.03  </span></span>
<span><span class="co">##                    NA's   :1</span></span></code></pre>
<p>VPD was not given with the original dataset and is calculated from
Tair and rH.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DEGebExample</span><span class="op">$</span><span class="va">VPD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fCalcVPDfromRHandTair.html">fCalcVPDfromRHandTair</a></span><span class="op">(</span><span class="va">DEGebExample</span><span class="op">$</span><span class="va">rH</span>, <span class="va">DEGebExample</span><span class="op">$</span><span class="va">Tair</span><span class="op">)</span></span>
<span><span class="va">EProc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/sEddyProc.html">sEddyProc</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">'DE-Geb'</span>, <span class="va">DEGebExample</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NEE'</span>,<span class="st">'Rg'</span>,<span class="st">'Tair'</span>,<span class="st">'VPD'</span>, <span class="st">'Ustar'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sSetLocationInfo</span><span class="op">(</span>LatDeg <span class="op">=</span> <span class="fl">51.1</span>, LongDeg <span class="op">=</span> <span class="fl">10.9</span>, TimeZoneHour <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co">#Location of Gebesee</span></span></code></pre></div>
<div class="section level3">
<h3 id="defining-seasons-with-different-surface-friction-conditions">Defining Seasons with different surface friction conditions<a class="anchor" aria-label="anchor" href="#defining-seasons-with-different-surface-friction-conditions"></a>
</h3>
<p>The site is a crop site. The harvesting times are visible as sharp
edges in the plots of NEE.</p>
<p>The micrometeorological conditions differ between the different
cropping periods, because the friction at the surface differs. Also not
the cropping periods do not correspond very well to seasons. Hence, for
the estimation of uStar-Thresholds, we apply a user-defined splitting of
uStar-seasons. With function <code>usCreateSeasonFactorYdayYear</code>
we provide the starting points of the seasons.</p>
<p>Note that, here, the seasons are not constrained within one
calendaryear. There are other variants of a user-specified season that
do respect calendaryear boundaries, or that let seasons start at the
same day each year.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seasonStarts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span> <span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70</span>,<span class="fl">2004</span><span class="op">)</span></span>
<span>          ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">210</span>,<span class="fl">2004</span><span class="op">)</span></span>
<span>          ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">320</span>,<span class="fl">2004</span><span class="op">)</span></span>
<span>          ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70</span>,<span class="fl">2005</span><span class="op">)</span></span>
<span>          ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">180</span>,<span class="fl">2005</span><span class="op">)</span></span>
<span>          ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">320</span>,<span class="fl">2005</span><span class="op">)</span></span>
<span>          ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>,<span class="fl">2006</span><span class="op">)</span></span>
<span>          ,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">305</span>,<span class="fl">2006</span><span class="op">)</span>      </span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seasonFactor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/usCreateSeasonFactorYdayYear.html">usCreateSeasonFactorYdayYear</a></span><span class="op">(</span></span>
<span>  <span class="va">DEGebExample</span><span class="op">$</span><span class="va">DateTime</span> <span class="op">-</span> <span class="fl">15</span><span class="op">*</span><span class="fl">60</span>, starts <span class="op">=</span> <span class="va">seasonStarts</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">NEE</span> <span class="op">~</span> <span class="va">DateTime</span>, <span class="va">DEGebExample</span> <span class="op">)</span></span>
<span><span class="va">seasonStartsDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fConvertTimeToPosix.html">fConvertTimeToPosix</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">seasonStarts</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    , DoY <span class="op">=</span> <span class="va">seasonStarts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, Hour <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>, <span class="st">'YDH'</span></span>
<span>    , Year <span class="op">=</span> <span class="st">"Year"</span>, Day <span class="op">=</span> <span class="st">"DoY"</span>, Hour <span class="op">=</span> <span class="st">"Hour"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span> v <span class="op">=</span> <span class="va">seasonStartsDate</span><span class="op">$</span><span class="va">DateTime</span><span class="op">)</span></span></code></pre></div>
<p><img src="DEGebExample_files/figure-html/DEGeb_estUStar1a-1.png" width="960" style="display:block; margin: auto"></p>
<p>The user-specific seasoning is provided to the gap-filling by the
argument <code>seasonFactor</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">uStarTh</span> <span class="op">&lt;-</span> <span class="va">EProc</span><span class="op">$</span><span class="fu">sEstUstarThold</span><span class="op">(</span>seasonFactor <span class="op">=</span> <span class="va">seasonFactor</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    aggregationMode seasonYear  season      uStar</span></span>
<span><span class="co">## 1           single         NA    &lt;NA&gt; 0.16041176</span></span>
<span><span class="co">## 2             year       2004    &lt;NA&gt; 0.13500000</span></span>
<span><span class="co">## 3             year       2005    &lt;NA&gt; 0.16041176</span></span>
<span><span class="co">## 4             year       2006    &lt;NA&gt; 0.25094444</span></span>
<span><span class="co">## 5           season       2004 2004001 0.13500000</span></span>
<span><span class="co">## 6           season       2004 2004070 0.12037500</span></span>
<span><span class="co">## 7           season       2004 2004210 0.08925000</span></span>
<span><span class="co">## 8           season       2005 2004320 0.16041176</span></span>
<span><span class="co">## 9           season       2005 2005070 0.12533333</span></span>
<span><span class="co">## 10          season       2005 2005180 0.13473214</span></span>
<span><span class="co">## 11          season       2006 2005320 0.04842361</span></span>
<span><span class="co">## 12          season       2006 2006120 0.06966667</span></span>
<span><span class="co">## 13          season       2006 2006305 0.25094444</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#EProc$useSeaonsalUStarThresholds()</span></span>
<span><span class="co"># estimation can be inspected by plotting the saturation of NEE with UStar </span></span>
<span><span class="co"># for the temperatures of one season</span></span>
<span><span class="co">#EProc$sPlotNEEVersusUStarForSeason( levels(uStarTh$season)[2] )</span></span></code></pre></div>
<p>Note that there is an estimate for each season. Further, an annual
estimate is obtained by taking the maximum across the seasons, and the
overall estimate is the mean across the years.</p>
<p>By default the gap-filling uses annually aggregated estimates of
uStar-Threshold. This usually works for sites with continuous vegetation
cover. For the crop-site of this example, we will use a different
threshold for each of the defined seasons, by calling
<code>sEddyProc_useSeaonsalUStarThresholds</code> before gapfilling.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">useSeaonsalUStarThresholds</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sGetUstarScenarios</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     season      uStar</span></span>
<span><span class="co">## 5  2004001 0.13500000</span></span>
<span><span class="co">## 6  2004070 0.12037500</span></span>
<span><span class="co">## 7  2004210 0.08925000</span></span>
<span><span class="co">## 8  2004320 0.16041176</span></span>
<span><span class="co">## 9  2005070 0.12533333</span></span>
<span><span class="co">## 10 2005180 0.13473214</span></span>
<span><span class="co">## 11 2005320 0.04842361</span></span>
<span><span class="co">## 12 2006120 0.06966667</span></span>
<span><span class="co">## 13 2006305 0.25094444</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sMDSGapFillAfterUstar</span><span class="op">(</span><span class="st">'NEE'</span>, FillAll <span class="op">=</span> <span class="cn">FALSE</span>, isVerbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="uncertainty-introduced-by-the-ustar-threshold-estimate-bootstrap">Uncertainty introduced by the uStar Threshold estimate:
bootstrap<a class="anchor" aria-label="anchor" href="#uncertainty-introduced-by-the-ustar-threshold-estimate-bootstrap"></a>
</h3>
<p>With a lower estimate of uStar threshold, more records with lower NEE
are kept in the dataset instead of marked as gaps. Therefore annual
estimate of NEE will decrease with lower uStar Threshold. Also the
partitioning of the net-flux to GPP and Reco is sensitive to inclusion
of data at dawn period with conditions of low uStar.</p>
<p>In order to quantify this uncertainty, a lower, median and upper
estimates of uStar are obtained from a bootstrapped sample of
half-hourly NEE measurements. The Gap-Filling and computation of derived
quantities such as GPP are then repeated for different estimates of the
uStar Threshold.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/sEddyProc.html">sEddyProc</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">'DE-Geb'</span>, <span class="va">DEGebExample</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NEE'</span>,<span class="st">'Rg'</span>,<span class="st">'Tair'</span>,<span class="st">'VPD'</span>, <span class="st">'Ustar'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sSetLocationInfo</span><span class="op">(</span>LatDeg <span class="op">=</span> <span class="fl">51.1</span>, LongDeg <span class="op">=</span> <span class="fl">10.9</span>, TimeZoneHour <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co">#Location of Gebesee</span></span>
<span><span class="co"># here, because of processing time only 30 samples instead of 100, and 10% and 90% </span></span>
<span><span class="co"># percentile instead of default 5%,50%, and 95% with 100 samples</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sEstimateUstarScenarios</span><span class="op">(</span> </span>
<span>  seasonFactor <span class="op">=</span> <span class="va">seasonFactor</span>, nSample <span class="op">=</span> <span class="fl">30L</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#(uStarScens &lt;- usGetSeasonalSeasonUStarMap(</span></span>
<span><span class="co">#  EProc$sGetEstimatedUstarThresholdDistribution()</span></span>
<span><span class="co">#))</span></span>
<span><span class="co">#EProc$sSetUstarScenarios(uStarScens)</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">useSeaonsalUStarThresholds</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sGetUstarScenarios</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     season      uStar        U10        U90</span></span>
<span><span class="co">## 5  2004001 0.13500000 0.11874009 0.15412045</span></span>
<span><span class="co">## 6  2004070 0.12037500 0.08538636 0.12177250</span></span>
<span><span class="co">## 7  2004210 0.08925000 0.09386250 0.16746306</span></span>
<span><span class="co">## 8  2004320 0.16041176 0.09177434 0.17215564</span></span>
<span><span class="co">## 9  2005070 0.12533333 0.10400556 0.16937143</span></span>
<span><span class="co">## 10 2005180 0.13473214 0.08419405 0.13203875</span></span>
<span><span class="co">## 11 2005320 0.04842361 0.04905486 0.10056250</span></span>
<span><span class="co">## 12 2006120 0.06966667 0.06113059 0.09647238</span></span>
<span><span class="co">## 13 2006305 0.25094444 0.12240556 0.25735196</span></span></code></pre>
<p>After setting the uStar scenarios, they will be used by method
<code>sMDSGapFillUStarScens</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sMDSGapFillUStarScens</span><span class="op">(</span><span class="st">'NEE'</span>, FillAll <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Additional output columns are produced for each uStar quantile.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^NEE.*_f$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span> <span class="va">EProc</span><span class="op">$</span><span class="fu">sExportResults</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "NEE_uStar_f" "NEE_U10_f"   "NEE_U90_f"</span></span></code></pre>
<p>Several methods provide processing steps for all scenarios. In
addition, method <code>sApplyUStarScen</code> calls a user-specified
function repeatedly with a modified argument <code>suffix</code>. For
example, the flux partitioning across all threshold scenarios can be
invoked by the following code to produce several GPP estimates.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span><span class="op">$</span><span class="fu">sMDSGapFill</span><span class="op">(</span><span class="st">'Tair'</span>, FillAll <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sApplyUStarScen</span><span class="op">(</span> <span class="va">EProc</span><span class="op">$</span><span class="va">sMRFluxPartition</span> <span class="op">)</span></span>
<span><span class="co">#grep("U10", colnames(EProc$sExportResults()), value = TRUE)    </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^GPP.*_f$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span> <span class="va">EProc</span><span class="op">$</span><span class="fu">sExportResults</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "GPP_U10_f"   "GPP_U90_f"   "GPP_uStar_f"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="using-change-point-detection-instead-of-moving-point-method-for-ustar-threshold-estimation">Using change point detection instead of moving point method for
UStar Threshold estimation<a class="anchor" aria-label="anchor" href="#using-change-point-detection-instead-of-moving-point-method-for-ustar-threshold-estimation"></a>
</h3>
<p>The package also provides another method of estimating the point
where NEE saturates with increasing uStar. With the ChangePointDetection
(CPT) method, the data is not binned by classes of uStar but the
changepoint is estimated based on the entire subset within one seasons
and one temperature class. The user invokes this method by specifying
argument
<code>ctrlUstarEst.l = usControlUstarEst(isUsingCPTSeveralT = TRUE)</code>
to <code>EstUstarThold</code> or
<code>sEstUstarThresholdDistribution</code>.</p>
<p>The CPT method is usually yields higher thresholds and marks more
data as Gap.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EProc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/sEddyProc.html">sEddyProc</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">'DE-Geb'</span>, <span class="va">DEGebExample</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'NEE'</span>,<span class="st">'Rg'</span>,<span class="st">'Tair'</span>,<span class="st">'VPD'</span>, <span class="st">'Ustar'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">resUStar</span> <span class="op">&lt;-</span> <span class="va">EProc</span><span class="op">$</span><span class="fu">sEstUstarThold</span><span class="op">(</span></span>
<span>                    ctrlUstarEst <span class="op">=</span> <span class="fu"><a href="../reference/usControlUstarEst.html">usControlUstarEst</a></span><span class="op">(</span>isUsingCPTSeveralT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>                    , seasonFactor <span class="op">=</span> <span class="va">seasonFactor</span></span>
<span>            <span class="op">)</span></span>
<span><span class="co">#(uStarThCP &lt;- usGetSeasonalSeasonUStarMap(resUStar))</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">useSeaonsalUStarThresholds</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">EProc</span><span class="op">$</span><span class="fu">sGetUstarScenarios</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     season     uStar</span></span>
<span><span class="co">## 5  2004001 0.4940012</span></span>
<span><span class="co">## 6  2004070 0.3167250</span></span>
<span><span class="co">## 7  2004210 0.2220000</span></span>
<span><span class="co">## 8  2004320 0.4977500</span></span>
<span><span class="co">## 9  2005070 0.3361000</span></span>
<span><span class="co">## 10 2005180 0.3029803</span></span>
<span><span class="co">## 11 2005320 0.3908000</span></span>
<span><span class="co">## 12 2006120 0.2138062</span></span>
<span><span class="co">## 13 2006305 0.3544000</span></span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Thomas Wutzler, Markus Reichstein, Antje Maria Moffat, Mirco Migliavacca.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
